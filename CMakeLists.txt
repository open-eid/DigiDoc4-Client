cmake_minimum_required(VERSION 3.5)
if(POLICY CMP0071)
	cmake_policy(SET CMP0071 NEW)
endif()
if(POLICY CMP0074)
	cmake_policy(SET CMP0074 NEW)
endif()
project(qdigidoc4 VERSION 4.2.4)

set(CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake/modules")
set(CMAKE_INCLUDE_CURRENT_DIR ON)
set(CMAKE_AUTOMOC ON)
set(MACOSX_BUNDLE_COPYRIGHT "(C) 2017-2020 Estonian Information System Authority")

include( GNUInstallDirs )
include( VersionInfo )

find_package( PKCS11 )
find_package( LibDigiDocpp 3.13.8 REQUIRED )
find_package( LDAP REQUIRED )
find_package( Qt5 COMPONENTS Core Widgets Network PrintSupport Svg LinguistTools REQUIRED )
include_directories( ${LIBDIGIDOCPP_INCLUDE_DIR} )

set_env( TSL_URL "https://ec.europa.eu/tools/lotl/eu-lotl.xml" CACHE STRING "TSL trust list primary URL" )
set_env( TSL_INCLUDE "EE" CACHE STRING "TSL list include in binary" )
set_env( MOBILEID_URL "https://dd-mid.ria.ee/mid-api" CACHE STRING "URL for Mobile-ID" )
set_env( SMARTID_URL "https://dd-sid.ria.ee/v1" CACHE STRING "URL for Smart-ID" )

if(APPLE)
        set(BUNDLE_NAME qdigidoc4) 
        add_subdirectory( extensions/DigiDocQL )
elseif(UNIX)
        option(ENABLE_KDE "Install KDE service menu (default: TRUE)" TRUE)
        option(ENABLE_NAUTILUS_EXTENSION "Build Nautilus extension (default: TRUE)" TRUE)
        set(DIGIDOC_EXECUTABLE qdigidoc4)
        set(DIGIDOC_ICON qdigidoc4)
        set(DIGIDOC_NAME DigiDoc4)
        if (ENABLE_KDE)
                add_subdirectory( extensions/kde )
        endif()
        if (ENABLE_NAUTILUS_EXTENSION)
                add_subdirectory( extensions/nautilus )
        endif()
endif()

add_subdirectory( common )
add_subdirectory( client )
